<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CoCo å¥åº·è¨ºæ–­ãƒ•ã‚©ãƒ¼ãƒ </title>
    <style>
        body { font-family: sans-serif; margin: 20px; background-color: #f0fff3; color: #3e2723; line-height: 1.6; }
        .container { max-width: 600px; margin: auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); position: relative; }
        .top-nav { display: flex; justify-content: flex-end; gap: 8px; margin-bottom: 15px; flex-wrap: wrap; }
        .nav-btn { padding: 6px 12px; font-size: 11px; font-weight: bold; border-radius: 20px; cursor: pointer; text-decoration: none; border: 1px solid #4CAF50; }
        .btn-chat { background-color: #f44336; color: white; border: none; }
        .btn-home { background-color: #fff; color: #4CAF50; }
        .btn-diary { background-color: #4CAF50; color: white; border: none; }
        h2 { text-align: center; color: #4CAF50; border-bottom: 2px solid #81C784; padding-bottom: 10px; margin-top: 0; }
        h3 { font-size: 16px; color: #66BB6A; margin-top: 25px; border-left: 4px solid #81C784; padding-left: 10px; background: #f9fff9; padding-top: 5px; padding-bottom: 5px; }
        h4 { font-size: 14px; color: #388E3C; margin-bottom: 8px; margin-top: 15px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 14px; }
        input, textarea, select { width: 100%; padding: 10px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 8px; font-size: 14px; }
        .flex-group { display: flex; gap: 10px; margin-bottom: 8px; align-items: center; }
        .flex-group label { width: 140px; flex-shrink: 0; font-size: 13px; margin-bottom: 0; color: #555; }
        .flex-group input { flex: 1; }
        button#mainSendBtn { width: 100%; padding: 15px; background-color: #66BB6A; color: white; border: none; border-radius: 30px; cursor: pointer; font-size: 16px; font-weight: bold; margin-top: 20px; box-shadow: 0 4px 0 #388E3C; }
        .upload-section { background-color: #e8f5e9; border: 1px dashed #A5D6A7; padding: 15px; border-radius: 10px; margin-top: 25px; text-align: center;}
    </style>
</head>
<body>

<div class="container">
    <div class="top-nav">
        <button class="nav-btn btn-chat" onclick="liff.closeWindow()">ğŸ’¬ CoCoå…ˆç”Ÿã«ç›´ç›¸è«‡</button>
        <button class="nav-btn btn-home" onclick="location.href='index.html'">ğŸ  ç›¸è«‡ã‚«ãƒ«ãƒ†</button>
        <button class="nav-btn btn-diary" onclick="location.href='diary.html'">ğŸ“ æ—¥è¨˜ã¸</button>
    </div>

    <h2 id="healthTitle">ğŸ“Š å¥åº·è¨ºæ–­è©³ç´°ã‚«ãƒ«ãƒ†</h2>
    <p style="font-size: 13px; text-align: center; color: #4CAF50;">å®šæœŸçš„ãªæ•°å€¤ãƒã‚§ãƒƒã‚¯ã§ç—…æ°—ã‚’äºˆé˜²ã—ã‚ˆã†ã­ï¼</p>

    <form id="healthForm">
        <div class="form-group">
            <label>ğŸ“… è¨ºæ–­æ—¥</label>
            <input type="date" id="diagDate" name="date">
        </div>
        
        <div class="form-group">
            <label>ğŸ¶ ãƒ¯ãƒ³ã¡ã‚ƒã‚“å</label>
            <input type="text" name="petName" id="petNameDiag" placeholder="ä¾‹: CoCo" required>
        </div>

        <div class="form-group">
            <label>ğŸ©º è¨ºæ–­ã•ã‚ŒãŸç—…å</label>
            <input type="text" name="diagnosisName" placeholder="ï¼ˆä¾‹ï¼šç‰¹ã«ç•°å¸¸ãªã—ã€è†µç‚ã€è…ä¸å…¨ãªã©ï¼‰">
        </div>

        <h3>ğŸ©¸ è¡€æ¶²æ¤œæŸ»ï¼ˆç”ŸåŒ–å­¦æ¤œæŸ»ï¼‰</h3>
        
        <h4>è‚è‡“ç³»</h4>
        <div class="flex-group"><label>ALT (GPT)</label><input type="number" step="0.1" name="ALT" placeholder="U/L"></div>
        <div class="flex-group"><label>ALP</label><input type="number" step="0.1" name="ALP" placeholder="U/L"></div>
        <div class="flex-group"><label>AST (GOT)</label><input type="number" step="0.1" name="AST" placeholder="U/L"></div>

        <h4>è…è‡“ç³»</h4>
        <div class="flex-group"><label>BUN (å°¿ç´ çª’ç´ )</label><input type="number" step="0.1" name="BUN" placeholder="mg/dL"></div>
        <div class="flex-group"><label>CRE (ã‚¯ãƒ¬ã‚¢ãƒãƒ‹ãƒ³)</label><input type="number" step="0.1" name="CRE" placeholder="mg/dL"></div>
        <div class="flex-group"><label>SDMA</label><input type="number" step="0.1" name="SDMA" placeholder="Âµg/dL"></div>

        <h4>è†µè‡“ãƒ»ç‚ç—‡ãƒ»ãã®ä»–</h4>
        <div class="flex-group"><label>v-LIP (è†µãƒªãƒ‘ãƒ¼ã‚¼)</label><input type="text" name="vLIP" placeholder="æ•°å€¤ã¾ãŸã¯é™½æ€§/é™°æ€§"></div>
        <div class="flex-group"><label>CRP (ç‚ç—‡åå¿œ)</label><input type="number" step="0.1" name="CRP" placeholder="mg/dL"></div>
        <div class="flex-group"><label>GLU (è¡€ç³–å€¤)</label><input type="number" step="0.1" name="GLU" placeholder="mg/dL"></div>
        <div class="flex-group"><label>T-Cho (ã‚³ãƒ¬ã‚¹ãƒ†ãƒ­ãƒ¼ãƒ«)</label><input type="number" step="0.1" name="TCHO" placeholder="mg/dL"></div>

        <h3>ğŸ”¬ è¡€çƒè¨ˆç®— (CBC)</h3>
        <div class="flex-group"><label>WBC (ç™½è¡€çƒ)</label><input type="number" step="0.1" name="WBC" placeholder="x10^3/ÂµL"></div>
        <div class="flex-group"><label>RBC (èµ¤è¡€çƒ)</label><input type="number" step="0.1" name="RBC" placeholder="x10^6/ÂµL"></div>
        <div class="flex-group"><label>HCT (ãƒ˜ãƒãƒˆã‚¯ãƒªãƒƒãƒˆ)</label><input type="number" step="0.1" name="HCT" placeholder="%"></div>
        <div class="flex-group"><label>PLT (è¡€å°æ¿)</label><input type="number" step="0.1" name="PLT" placeholder="x10^4/ÂµL"></div>

        <div class="form-group" style="margin-top: 30px;">
            <label>ğŸ’¬ ç£åŒ»ã•ã‚“ã‹ã‚‰ã®ã‚³ãƒ¡ãƒ³ãƒˆ</label>
            <textarea name="vetComments" rows="3" placeholder="å…ˆç”Ÿã‹ã‚‰ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚„ã€æ—¥é ƒã®æ§˜å­ãªã©"></textarea>
        </div>

        <div class="upload-section">
            <p style="font-size: 14px; margin-bottom: 10px; font-weight: bold; color: #388E3C;">ğŸ“¸ æ¤œæŸ»çµæœã®å†™çœŸã‚’ã‚¢ãƒƒãƒ—</p>
            <input type="file" id="diagPhoto" accept="image/*" multiple>
        </div>

        <button type="submit" id="mainSendBtn">CoCoã«å¥åº·è¨ºæ–­çµæœã‚’é€ã‚‹</button>
    </form>
</div>

<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<script>
    const scriptUrl = 'https://script.google.com/macros/s/AKfycbyiCJEBqS-6DrnTsH9TopgEb6D1uM8dmbzr8p3iocwli17V7jRr4fHB-jewakTEG2Qf/exec';    
    document.getElementById('diagDate').valueAsDate = new Date();
    liff.init({ liffId: "2008861082-o5jaHAfN" });

    document.getElementById('petNameDiag').addEventListener('input', function() {
        const name = this.value;
        document.getElementById('healthTitle').innerText = name ? `ğŸ“Š ${name}ã®å¥åº·è¨ºæ–­ã‚«ãƒ«ãƒ†` : `ğŸ“Š å¥åº·è¨ºæ–­è©³ç´°ã‚«ãƒ«ãƒ†`;
    });

    document.getElementById('healthForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const btn = document.getElementById('mainSendBtn');
        btn.innerText = 'é€ä¿¡ä¸­...';
        btn.disabled = true;

        const formData = new FormData(this);
        const data = Object.fromEntries(formData.entries());

        fetch(scriptUrl, { method: 'POST', mode: 'no-cors', body: JSON.stringify(data) })
        .then(() => {
            let message = `ã€å¥åº·è¨ºæ–­çµæœ ${data.date}ã€‘\nãƒ¯ãƒ³ã¡ã‚ƒã‚“: ${data.petName}\n`;
            message += `ALT: ${data.ALT || '-'} / ALP: ${data.ALP || '-'}\n`;
            message += `BUN: ${data.BUN || '-'} / CRE: ${data.CRE || '-'}\n`;
            message += `CRP: ${data.CRP || '-'} / v-LIP: ${data.vLIP || '-'}\n`;
            message += `[ã‚³ãƒ¡ãƒ³ãƒˆ] ${data.vetComments || 'ãªã—'}`;

            return liff.sendMessages([{ type: 'text', text: message }]);
        })
        .then(() => {
            alert("ä¿å­˜ã—ã¦ã€CoCoã«çµæœã‚’é€ã£ãŸã‚ˆï¼");
            liff.closeWindow();
        })
        .catch(err => {
            alert("ã‚¨ãƒ©ãƒ¼ãŒèµ·ããŸã‚ˆ");
            btn.disabled = false;
        });
    });
</script>
</body>
</html>